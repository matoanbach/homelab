## Terraform Providers
- We have been using Terraform to create and manage resources for a specific provider.
- Organizations would want end-to-end solution for creation of infrastructure and configuring appropriate packages required for the application.

## Introducing Provisioners
- Provisioners are used to execute scripts on a local or remote machine as part of resource creation or destruction.
- Example: After VM is launched, install software package required for application.

## Types of Provisioners in Terraform
### `local-exec` provisioner
- The `local-exec` provisioner invokes a local executable after a resource is created.
- Example: After EC2 is launched, fetch the IP and store it in file server_ip.txt

### `remote-exec` provisioner
- `remote-exec` provisioners allow to invoke scripts or run commands directly on the remote server.
- Example: After EC2 is launched, install "apache" software

## Format of Provisioner
### Defining Provisioners
- Provisioners are defined inside a specific resource
```
resource "aws_instance" "myec2" {
    ami = "ami-..."
    instance_type = "t2.micro"
    <provisioners-need-to-be-defined-inside-resource>
}
```
- Provisioners are defined by "provisioner" followed by type of provisioner

```
resource "aws_instance" "myec2" {
    ami = "ami-..."
    instance_type = "t2.micro"

    provisioner "local-exec" {}

    provisioner "remote-exec" {}
}
```

### Local Provisioner Approach
- For local provisioners, we have to specify command that needs to run locally
```
resource "aws_instance" "example" {
    ami = "ami-09sdad..."
    instance_type = "t2.micro"

    provisioner "local-exec" {
        command = "echo Server has been created through Terraform"
    }
}
```

### Remote Exec Provisioner Approach
- Since commands are executed on remote-server, we have to provide way for Terraform to connect to remote server.
```
resource "aws_instance" "myec2" {
    ami = "ami-..."
    instance_type = "t2.micro"

    connection {
        type = "ssh"
        user = "ec2-user"
        private_key = file("./terraform-key.perm")
        host = self.public_ip
    }

    provisioner "remote-exec" {
        inline = [
            "sudo yum install -y nginx"
            "sudo systemctl start nginx"
        ]
    }
}
```

## Notes
### Provisioner are defined inside resource block
- It is not necessary to define a `aws_instance` resource block for provisioner to run.
- They can be defined inside other resource types as well
```
resource "aws_iam_user" "lb" {
    name = "loadbalancer"
    provisioner "local-exec" {
        command = "echo local-exec provisioner is starting"
    }
}
```
### Multiple provisioner blocks for single resource
- We can define multiple provisioners block in a single resource block.
```
resource "aws_iam_user" "lb" {
    name = "loadbalancer"
    provisioner "local-exec" {
        command = "echo local-exec provisioner is starting"
    }

    provisioner "local-exec" {
        command = "echo local-exec-2 provisioner is starting"
    }
}
```
